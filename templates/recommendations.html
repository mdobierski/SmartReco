{% extends "base.html" %}

{% block title %}{{ rec_type }} Recommendations - SmartReco{% endblock %}

{% block content %}
<h2>{{ rec_type }} Recommendations</h2>

{% if movies %}
<div class="movies-grid">
    {% for movie in movies %}
    <div class="movie-card">
        {% if movie.poster_path %}
        <a href="{{ url_for('movie_detail', movie_id=movie.id, return_to=request.url) }}">
            <img src="https://image.tmdb.org/t/p/w200{{ movie.poster_path }}" alt="{{ movie.title }}">
        </a>
        {% endif %}
        <h4><a href="{{ url_for('movie_detail', movie_id=movie.id, return_to=request.url) }}">{{ movie.title }}</a></h4>
        <div class="movie-card-info">
            {% if rec_type == 'Personal' %}
            <div><strong>Match: {{ percents[loop.index0]|round(1) }}%</strong></div>
            {% endif %}
            <div>Year: {{ movie.year or '-' }}</div>
            <div>Genre: {{ movie.genre or '-' }}</div>
            <div>Country: {{ movie.country or '-' }}</div>
            <div>TMDb: {{ movie.vote_average or '-' }} ({{ movie.vote_count or 0 }})</div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="pagination">
    {% if page > 1 %}
    {% if rec_type == 'Personal' %}
    <a href="{{ url_for('personal_recommend', page=page-1) }}">« Prev</a>
    {% else %}
    <a
        href="{{ url_for('criteria_results', page=page-1, countries=countries, genres=genres, year_from=year_from, year_to=year_to) }}">«
        Prev</a>
    {% endif %}
    {% endif %}

    {% if rec_type == 'Personal' %}
    <form method="get" action="{{ url_for('personal_recommend') }}" class="pagination-jump">
        <label>Page</label>
        <input type="number" name="page" min="1" max="{{ total_pages }}" value="{{ page }}" required>
        <span>/ {{ total_pages }}</span>
    </form>
    {% else %}
    <form method="get" action="{{ url_for('criteria_results') }}" class="pagination-jump">
        <label>Page</label>
        <input type="number" name="page" min="1" max="{{ total_pages }}" value="{{ page }}" required>
        <span>/ {{ total_pages }}</span>
        <input type="hidden" name="countries" value="{{ countries }}">
        <input type="hidden" name="genres" value="{{ genres }}">
        <input type="hidden" name="year_from" value="{{ year_from }}">
        <input type="hidden" name="year_to" value="{{ year_to }}">
    </form>
    {% endif %}

    {% if page < total_pages %} {% if rec_type=='Personal' %} <a
        href="{{ url_for('personal_recommend', page=page+1) }}">Next »</a>
        {% else %}
        <a
            href="{{ url_for('criteria_results', page=page+1, countries=countries, genres=genres, year_from=year_from, year_to=year_to) }}">Next
            »</a>
        {% endif %}
        {% endif %}
</div>
{% else %}
<div class="empty-state">
    <h3>No recommendations found</h3>
    <p>No movies match the selected criteria.</p>
    <p>Try changing filters or updating your preferences.</p>
</div>
{% endif %}
{% endblock %}
